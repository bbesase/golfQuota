


<html lang="en">
<head>
  <meta charset="UTF-8">
  
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" crossorigin="anonymous"></script>

  <script type="text/javascript" src="https://cdn.datatables.net/s/dt/dt-1.10.10,b-1.1.0/datatables.min.js"></script>
  <script type="text/javascript" src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>


  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/s/dt/dt-1.10.10,b-1.1.0/datatables.min.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" crossorigin="anonymous"/>
  
</head>
<body>

  


  
  <div class="container">
    <table id="golfTable" class="display" cellspacing="0">
      <thead>
        <tr>
            <th>Name</th>
            <th>Quota 1</th>
            <th>Quota 2</th>
            <th>Quota 3</th>
            <th>Quota 4</th>
            <th>Quota 5</th>
            <th>Quota 6</th>
            <th>Average Quota</th>
        </tr>
      </thead>
      <!--<tfoot>
        <tr>
            <th>Name</th>
            <th>Quota 1</th>
            <th>Quota 2</th>
            <th>Quota 3</th>
            <th>Quota 4</th>
            <th>Quota 5</th>
            <th>Quota 6</th>
            <th>Average Quota</th>
        </tr>
      </tfoot>-->
      <tbody id="tableBody">
        <!--<tr>
            <td>Brent Besase</td>
            <td>5</td>
            <td>5</td>
            <td>5</td>
            <td>5</td>
            <td>5</td>
            <td>5</td>
            <td>5</td>
        </tr>-->
      </tbody>
    </table>
  </div>

  <div id='buttonContainer'>

    <button id="add" data-toggle="modal" data-target="#golfModal">Add Golfer</button>
    <br>
    <button id="addScore" data-toggle="modal" >Add Score</button>
    <br>
    <button id="edit" data-toggle="modal">Edit Golfer</button>
    <br>
    <button id="delete" data-toggle="modal" data-target="#deleteModal">Delete Golfer</button>
    <br>
  </div>


  <div id="golfModal" class="modal fade" tabindex="-1" role="dialog" style="display:none;">
   
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Add Golfer</h4>
          </div>
          <div class="modal-body">
          <label for='golferFirstName'>Golfers First Name</label><br>
            <input type="text" class="form-control" id="golferFirstName" placeholder="First Name"></input>
            <hr class='hr'>
            <label for='golferLastName'>Golfers Last Name</label><br>
            <input type="text" class="form-control" id="golferLastName" placeholder="Last Name"></input>
            <hr class='hr'>
            <div id='quotaTopRow'>
              <input type="number" class='quotaInputs form-control' placeholder="Round 1" id="quota1" min='0'>
              <input type="number" class='quotaInputs form-control' placeholder="Round 2" id="quota2" min='0'>
              <input type="number" class='quotaInputs form-control' placeholder="Round 3" id="quota3" min='0'>
            </div>
            <hrclass='hr'>
            <div id='quotaBottomRow'>
              <input type="number" class='quotaInputs form-control' placeholder="Round 4" id="quota4" min='0'>
              <input type="number" class='quotaInputs form-control' placeholder="Round 5" id="quota5" min='0'>
              <input type="number" class='quotaInputs form-control' placeholder="Round 6" id="quota6" min='0'>
            </div>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default addButtons" data-dismiss="modal">Close</button>
            <button type="button" id='addSave' class="btn btn-primary addButtons">Save changes</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
   
  </div>

  <div id="deleteModal" class="modal fade" tabindex="-1" role="dialog" style="display:none;">
   
      <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Delete Golfer</h4>
            </div>
            <div class="modal-body">
                <h4 class="modal-title">Are you sure you want to delete this golfer?</h4>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a class="btn btn-danger btn-ok" id='deleteGolfer'>Delete</a>
            </div>
        </div>
    </div>
   
  </div>

  <div id="errorModal" class="modal fade" tabindex="-1" role="dialog" style="display:none;">
   
      <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Error</h4>
            </div>
            <div class="modal-body">
                <h4 class="modal-title">Please Make Sure You Have A Golfer Selected In The Table!</h4>
            </div>
            <div class="modal-footer">
                <a class="btn btn-danger btn-ok" id='ok' data-dismiss="modal">Ok</a>
            </div>
        </div>
    </div>
   
  </div>

</body>
</html>



<style>

.container{
  /*position: absolute;
  left: 33%;
  top: 25%;
  bottom: 25%;*/
  margin-top: 5%;
}

#buttonContainer{
  /*margin-top: 15%;
  margin-left: 15%;*/
  overflow: hidden;
}

#add{
  width: 7%;
  border-radius: 10px;
  background-color: #76FF03;
  color: white;
  
  height: 9%;

}

#add:hover{
  background-color: white;
  color: #76FF03;
}

#addScore{
  width: 7%;
  border-radius: 10px;
  background-color: #03A9F4;
  color: white;
  
  height: 9%;

}

#addScore:hover{
  background-color: white;
  color: #03A9F4;
}

#edit{
  width: 7%;
  border-radius: 10px;
  background-color: #FB8C00;
  color: white;
  
  height: 9%;

}

#edit:hover{
  background-color: white;
  color: #FB8C00;
}

#delete{
  width: 7%;
  border-radius: 10px;
  background-color: #F44336;
  color: white;
  height: 9%;

}

#delete:hover{
  background-color: white;
  color: #F44336;
}

.quotaInputs{
  width: 25%;
  display: inline;
}

#quotaTopRow{
  margin-left: 15%;

}

#quotaBottomRow{
  margin-left: 15%;

}

.addButtons{
  width: 25%;
}

.hr{
  height: 1px;
}

.dataTables_empty{
  display: none;
}



</style>

<script language="javascript">
  $(document).ready(function(){

    //make the connection to the firebase app online
    var myData = new Firebase('https://golf-quota.firebaseIO.com//');
   
    //on page load gets the child data, and everything else under it. 
    myData.once('value', function(snapshot){
      snapshot.forEach(function(childSnapshot){

          var key = childSnapshot.key();
          var childData = childSnapshot.val();
          //var foo = snapshot.hasChild('Jeff Besase');
          uniqueKey.push({
            'key': key,
            'name': childData.Name
          });
          createTable(childSnapshot.val());
      });
    });

    myData.on('child_added', function(snapshot) {
      var key = snapshot.key();
     
      
    });


    function createTable(snap){

      if(snap != undefined){

          $('#tableBody').append(
            '<tr>' +
              '<td>' + snap.Name + '</td>' +
              '<td>' + snap.Score1 + '</td>' + 
              '<td>' + snap.Score2 + '</td>' +
              '<td>' + snap.Score3 + '</td>' +
              '<td>' + snap.Score4 + '</td>' +
              '<td>' + snap.Score5 + '</td>' +
              '<td>' + snap.Score6 + '</td>' +
              '<td>' + snap.AverageQuota + '</td>' +
        '</tr>');
      }
    }
    
    //create an array to store the golfer data
    var golferData = [],
        editData   = [],
        uniqueKey  = [];

    //this will be used to keep track whether or not the user selected add, edit, delete, etc...
    var status = 0;

    var nameExists = '';

    //Sets a variable = to the table data
    var table = $('#golfTable').DataTable();
    

    //sets up the table so you can see data
    $('#golfTable').DataTable();

    //runs when you click a row in the table
    $('#golfTable').on( 'click', 'tr', function () {

      //clear out the editData array
      editData = [];

      if(this.children[0].innerHTML === ''){
        editData = undefined;
      }
      editData.push({

          Name         : this.children[0].innerHTML,
          Score1       : this.children[1].innerHTML,
          Score2       : this.children[2].innerHTML,
          Score3       : this.children[3].innerHTML,
          Score4       : this.children[4].innerHTML,
          Score5       : this.children[5].innerHTML,
          Score6       : this.children[6].innerHTML,
          AverageQuota : this.children[7].innerHTML
      });

      console.log( table.row( this ).data() );
      
      //loops through each row when you click a row
      $('#golfTable tr').each(function(){

        //if the row (this) has the selected class attached to it...
          if ( $(this).hasClass('selected') ){

            //remove the selected class so it becomes un-highlighted
            $(this).removeClass('selected');
          }
          

      });

      //Adds the selected class to the row which highlights it
      $(this).addClass('selected');
        

    });

    


    //runs when the modal gets closed
      //searches modal for all possible inputs and clears them out
    $('#golfModal').on('hidden.bs.modal', function (e) {
      $(this)
        .find("input,textarea,select")
           .val('')
           .end()
        .find("input[type=checkbox], input[type=radio]")
           .prop("checked", "")
           .end();
    })

    //runs when ever the modal gets shown
    $('#golfModal').on('shown.bs.modal', function () {
      //$('#myInput').focus()
      console.log("HI");
      modalLogic(status);
    })

    //Jquery button click handler for when the Add button is clicked
    $('#addSave').click(function(){
      
      setData(status, myData, getAddInputs(), nameExists);
      $('#golfModal').modal('hide');
    });
  
    //Runs when the add button is clicked
    $('#add').click(function(){
      status = 1;
    });

    //Runs when the Add Score button is clicked
    $('#addScore').click(function(){
      status = 2;
      if(editData.length == 0 || editData === undefined || editData === ''){
          $('#errorModal').modal('show');
      }
      else{
          $('#golfModal').modal('show');
          modalLogic(status);
      }
    });

    //Runs when the Edit button is clicked
    $('#edit').click(function(){
      status = 3;
      if(editData.length == 0 || editData === undefined || editData === ''){
          $('#errorModal').modal('show');
      }
      else{
          $('#golfModal').modal('show');
          modalLogic(status);
      }

    });

    
    function setData(modalStatus, table, data, isName){
      var name = data[0].Name;
      if(modalStatus === 1){
        if(!doesThisExist(name)){
          
          // var ref = table + '/' + name + '/';
          // table = new Firebase(ref);
          table.push({
             //name: {
              Name: data[0].Name,
              Score1: data[0].Score1,
              Score2: data[0].Score2,
              Score3: data[0].Score3,
              Score4: data[0].Score4,
              Score5: data[0].Score5,
              Score6: data[0].Score6,
              AverageQuota: data[0].AverageQuota
            //}
          });

          status = 0;
        }
      }
      else if(modalStatus === 2){
        //firebase code to add score
        //var name = data[0].Name;
        if(doesThisExist(name)){
          var key;
          for(var i = 0; i < uniqueKey.length; i++){
              if(name === uniqueKey[i].name){
                key = uniqueKey[i].key;
                break;
              }
          }
          var ref = table + '/' + key + '/';
          table = new Firebase(ref);
          table.update({
             
              Name: data[0].Name,
              Score1: data[0].Score1,
              Score2: data[0].Score2,
              Score3: data[0].Score3,
              Score4: data[0].Score4,
              Score5: data[0].Score5,
              Score6: data[0].Score6,
              AverageQuota: data[0].AverageQuota
            
          });
          status = 0;
        }
      }
      else if(modalStatus === 3){
        //firebase code edit/update
        if(isName != '' || isName != undefined){
          if(doesThisExist(isName)){
            var key;
            for(var i = 0; i < uniqueKey.length; i++){
                if(isName === uniqueKey[i].name){
                  key = uniqueKey[i].key;
                  break;
                }
            }
            var ref = table + '/' + key + '/';
            table = new Firebase(ref);
            table.update({
               
                Name: data[0].Name,
                Score1: data[0].Score1,
                Score2: data[0].Score2,
                Score3: data[0].Score3,
                Score4: data[0].Score4,
                Score5: data[0].Score5,
                Score6: data[0].Score6,
                AverageQuota: data[0].AverageQuota
              
            });
          status = 0;
          nameExists = '';
        }
      }
      
    }
  }

    function getAddInputs(){
      //function gets all of the user inputted value from the addModal
      var firstName = $('#golferFirstName').val();
      var lastName  = $('#golferLastName').val();
      var fullName  = firstName.trim() + ' ' + lastName.trim();
      var quota1    = Number($('#quota1').val());
      var quota2    = Number($('#quota2').val());
      var quota3    = Number($('#quota3').val());
      var quota4    = Number($('#quota4').val());
      var quota5    = Number($('#quota5').val());
      var quota6    = Number($('#quota6').val());
      var avgQuta   = Math.round((quota1 + quota2 + quota3 + quota4 + quota5 + quota6) / 6 * 10) / 10;

      golferData.push({

          Name         : fullName,
          Score1       : quota1,
          Score2       : quota2,
          Score3       : quota3,
          Score4       : quota4,
          Score5       : quota5,
          Score6       : quota6,
          AverageQuota : avgQuta
      });

      return golferData;

      
    }

    function modalLogic(modalStatus){
      if(modalStatus === 1){
        //code to config logic with status == add
      }
      else if(modalStatus === 2){
        //code to config logic with status == add score
          //first name, last name, score2-avg blacked out
          $('#quota1').focus();

          //Make all inputs except quota 1 (newest score) readonly
          $('#golferFirstName').prop('readonly', true);
          $('#golferLastName').prop('readonly', true);
          $('#quota2').prop('readonly', true);
          $('#quota3').prop('readonly', true);
          $('#quota4').prop('readonly', true);
          $('#quota5').prop('readonly', true);
          $('#quota6').prop('readonly', true);

          //split the fullname into first and last name
          var editName = editData[0].Name,
              fname    = editName.split(' ')[0],
              lname    = editName.split(' ')[1];

          //Move all of the scores to the next input area
          $('#quota2').val(editData[0].Score1);
          $('#quota3').val(editData[0].Score2);
          $('#quota4').val(editData[0].Score3);
          $('#quota5').val(editData[0].Score4);
          $('#quota6').val(editData[0].Score5);
          $('#golferFirstName').val(fname);
          $('#golferLastName').val(lname);





      }
      else if(modalStatus === 3){
        //code to config logic with status == edit

        $('#golferFirstName').focus();
        //split the fullname into first and last name
        var editName = editData[0].Name,
            fname    = editName.split(' ')[0],
            lname    = editName.split(' ')[1];

        //Move all of the scores to the next input area
        $('#quota1').val(editData[0].Score1);
        $('#quota2').val(editData[0].Score2);
        $('#quota3').val(editData[0].Score3);
        $('#quota4').val(editData[0].Score4);
        $('#quota5').val(editData[0].Score5);
        $('#quota6').val(editData[0].Score6);
        $('#golferFirstName').val(fname);
        $('#golferLastName').val(lname);

        nameExists = editName;


      }

    }

    function doesThisExist(golferName){

        for(var i = 0; i < uniqueKey.length; i++){
            if(uniqueKey[i].name === golferName){
              return true;
            }
        } 

        return false;
      
    }

    

  });
</script>